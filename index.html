<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Happy Birthday, My Darling! üéÅ</title>
<meta name="description" content="Click the tiles to reveal your gift‚Ä¶">
<style>
  :root {
    --size: min(90vmin, 640px);
    --tile: calc(var(--size) / 3);
    --accent: #ff9ecf; /* gentle pink */
    --bg: #0f0f12;
    --tileTop: #f6e9f0;
  }
  html, body { height:100%; margin:0; }
  body {
    display:flex; align-items:center; justify-content:center;
    background: radial-gradient(1200px at 20% -10%, #1b1b23, #0a0a0c 70%), var(--bg);
    color:#fff; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .card {
    width:var(--size); max-width:95vw; aspect-ratio:1/1;
    position:relative; perspective:1000px;
    border-radius:24px; overflow:hidden; box-shadow: 0 20px 60px rgba(0,0,0,.45);
    background:#111;
  }
  .image {
    position:absolute; inset:0;
    background: center/cover no-repeat;
    filter:saturate(1.05);
  }
  /* blur overlay before start */
  .veil {
    position:absolute; inset:0; backdrop-filter: blur(8px) brightness(.5);
    display:flex; align-items:center; justify-content:center; flex-direction:column; gap:.8rem;
  }
  .veil h1 { margin:0; font-weight:700; letter-spacing:.3px; }
  .veil a.start {
    color:#111; background:linear-gradient(135deg,var(--accent),#ffd3e6);
    text-decoration:none; font-weight:700; padding:.85rem 1.1rem; border-radius:999px;
    box-shadow:0 8px 24px rgba(0,0,0,.35);
  }
  .subtitle { opacity:.8; font-size:.95rem }
  /* 3x3 tile grid */
  .tiles { position:absolute; inset:0; transform-style:preserve-3d; }
  .tile {
    position:absolute; width:var(--tile); height:var(--tile);
    background: conic-gradient(from 200deg at 30% 30%, #ffffff, var(--tileTop));
    border:1px solid rgba(255,255,255,.18);
    box-shadow: 0 8px 24px rgba(0,0,0,.35);
    cursor:pointer; transition: transform .7s cubic-bezier(.19,1,.22,1), opacity .7s ease;
    display:grid; place-items:center; font-weight:700; color:#333; user-select:none;
  }
  .tile:hover { transform: translateZ(1px) scale(1.015); }
  .tile.fall {
    opacity:0; pointer-events:none;
    transform: translate3d(var(--tx), var(--ty), -120px) rotate3d(var(--rx), var(--ry), 0, var(--rot));
  }
  .hud {
    position:absolute; bottom:12px; left:50%; transform:translateX(-50%);
    font-size:.9rem; opacity:.75; text-align:center;
  }
  .final {
    position:absolute; inset:0; display:none; place-items:center; text-align:center;
    background: linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.45) 55%, rgba(0,0,0,.7));
  }
  .final.show { display:grid; animation: pop .5s ease-out both; }
  @keyframes pop { from { transform:scale(.98); opacity:0 } to { transform:scale(1); opacity:1 } }
  .final .box {
    background: rgba(255,255,255,.1);
    border:1px solid rgba(255,255,255,.2);
    padding:1rem 1.25rem; border-radius:16px; backdrop-filter: blur(6px);
  }
  .btn {
    display:inline-block; margin-top:.6rem; padding:.6rem .9rem; border-radius:10px; font-weight:700;
    background:linear-gradient(135deg,#ffe075,#ffc14d); color:#111; text-decoration:none;
    box-shadow:0 6px 18px rgba(0,0,0,.35);
  }
  .brand {
    position:absolute; top:10px; left:12px; font-size:.9rem; opacity:.7; letter-spacing:.3px;
  }
  .brand b { color: var(--accent); }
  /* small footer link style */
  .smalllink { color:#bbb; text-underline-offset:3px; }
</style>
</head>
<body>
  <div class="card" id="card">
    <!-- background image (voucher) -->
    <div class="image" id="bg"></div>

    <!-- pre-start veil -->
    <div class="veil" id="veil">
      <div class="brand">For <b>Claire</b> ‚Ä¢ 01 Nov 2025</div>
      <h1>Click to reveal your surprise</h1>
      <div class="subtitle">9 tiles. 9 taps. Treats await.</div>
      <a href="#open" class="start" id="startLink">Open the gift</a>
      <div class="subtitle" style="font-size:.85rem;">(or press <span style="font-family:monospace">Enter</span>)</div>
    </div>

    <!-- tiles -->
    <div class="tiles" id="tiles" aria-label="Click tiles to reveal"></div>

    <!-- HUD -->
    <div class="hud" id="hud">9 tiles remaining</div>

    <!-- final message -->
    <div class="final" id="final">
      <div class="box">
        <div style="font-size:1.1rem; font-weight:700;">Happy Birthday, Claire! üéâ</div>
        <div style="opacity:.85; margin-top:.25rem;">Enjoy your Trinny London treat.</div>
        <a class="btn" id="redeemBtn" target="_blank" rel="noopener">Redeem</a>
        <div style="margin-top:.5rem;"><a id="reset" href="#" class="smalllink">Reset tiles</a></div>
      </div>
    </div>
  </div>

<script>
/* --- Config via URL params ----------------------------------------------
   ?img=URL_TO_VOUCHER&to=Claire&redeem=https://...&accent=%23ff9ecf
------------------------------------------------------------------------- */
const params = new URLSearchParams(location.search);
const imgURL = params.get('img') || 'TrinnyVoucher.png';
const toName = params.get('to') || 'Claire';
const redeemURL = params.get('redeem') || 'https://www.trinnylondon.com/';
const accent = params.get('accent'); if (accent) document.documentElement.style.setProperty('--accent', accent);

/* --- Elements ---------------------------------------------------------- */
const bg = document.getElementById('bg');
const tiles = document.getElementById('tiles');
const veil = document.getElementById('veil');
const startLink = document.getElementById('startLink');
const hud = document.getElementById('hud');
const final = document.getElementById('final');
const redeemBtn = document.getElementById('redeemBtn');
const reset = document.getElementById('reset');
document.querySelector('.brand').innerHTML = `For <b>${toName}</b> ‚Ä¢ ${new Date().toLocaleDateString(undefined,{day:'2-digit',month:'short',year:'numeric'})}`;

/* --- Background image -------------------------------------------------- */
bg.style.backgroundImage = `url('${imgURL}')`;

/* --- Build tiles ------------------------------------------------------- */
const N = 3; // 3x3
let remaining = N*N;

function placeTiles() {
  tiles.innerHTML = '';
  const size = tiles.clientWidth; // for random directions
  for (let r=0; r<N; r++){
    for (let c=0; c<N; c++){
      const t = document.createElement('button');
      t.className = 'tile';
      t.setAttribute('aria-label', `Tile ${r*N+c+1}`);
      t.style.top  = `calc(${r} * var(--tile))`;
      t.style.left = `calc(${c} * var(--tile))`;
      t.textContent = 'üéÅ';
      // random fall direction & rotation
      const dx = (Math.random() * 2 - 1) * size * .8;
      const dy = (Math.random() * 2 - 1) * size * .8;
      const rx = (Math.random() * 2 - 1).toFixed(2);
      const ry = (Math.random() * 2 - 1).toFixed(2);
      const rot = (Math.random() * 140 + 80).toFixed(0) + 'deg';
      t.style.setProperty('--tx', dx+'px');
      t.style.setProperty('--ty', dy+'px');
      t.style.setProperty('--rx', rx);
      t.style.setProperty('--ry', ry);
      t.style.setProperty('--rot', rot);
      t.addEventListener('click', () => hideTile(t));
      tiles.appendChild(t);
    }
  }
  remaining = N*N;
  updateHUD();
}
placeTiles();

/* --- Start interaction ------------------------------------------------- */
function start() {
  veil.style.display = 'none';
}
startLink.addEventListener('click', (e)=>{ e.preventDefault(); start(); history.replaceState({},'',location.pathname+location.search+'#open'); });
document.addEventListener('keydown', e=>{ if(e.key==='Enter' && veil.style.display!=='none') start(); });

/* --- Tile click logic -------------------------------------------------- */
function hideTile(tile){
  tile.classList.add('fall');
  remaining--;
  updateHUD();
  confettiBurst(tile);
  if (remaining === 0) finish();
}

function updateHUD() {
  hud.textContent = `${remaining} tile${remaining!==1?'s':''} remaining`;
}

/* --- Finish state ------------------------------------------------------ */
function finish() {
  final.classList.add('show');
  redeemBtn.href = redeemURL;
  megaConfetti();
}

/* --- Reset ------------------------------------------------------------- */
reset.addEventListener('click', (e)=>{ e.preventDefault(); final.classList.remove('show'); placeTiles(); updateHUD(); });

/* --- Minimal confetti (no libraries) ---------------------------------- */
function confettiBurst(originEl){
  const rect = originEl.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top  + rect.height/2;
  burstAt(cx, cy, 18);
}
function megaConfetti(){
  const rect = tiles.getBoundingClientRect();
  burstAt(rect.left + rect.width/2, rect.top + rect.height/2, 80);
}
function burstAt(x, y, count){
  for (let i=0;i<count;i++){
    const p = document.createElement('div');
    p.style.position = 'fixed';
    p.style.left = x+'px'; p.style.top = y+'px';
    p.style.width = '8px'; p.style.height='14px';
    p.style.background = `hsl(${Math.random()*360}, 90%, 60%)`;
    p.style.transform = `rotate(${Math.random()*360}deg)`;
    p.style.borderRadius='2px';
    p.style.pointerEvents='none';
    document.body.appendChild(p);
    const ang = Math.random()*Math.PI*2, vel = Math.random()*7+3;
    const vx = Math.cos(ang)*vel, vy = Math.sin(ang)*vel - 4;
    let life = 0, x0 = x, y0 = y;
    const tick = ()=>{
      life += 1;
      x0 += vx; y0 += vy + life*0.15; // gravity
      p.style.left = x0+'px'; p.style.top = y0+'px'; p.style.opacity = String(1 - life/60);
      if (life<60) requestAnimationFrame(tick); else p.remove();
    };
    requestAnimationFrame(tick);
  }
}

/* --- Deep link: start automatically if #open present ------------------ */
if (location.hash === '#open') start();

/* --- Share helper in console ------------------------------------------ */
console.log('%cTip:', 'color:#ffd3e6', 'Customize with URL params, e.g.:');
console.log(location.origin + location.pathname + '?to=Claire&img=/voucher.jpg&redeem=https%3A%2F%2Fwww.trinnylondon.com%2F&accent=%23ff9ecf#open');
</script>
</body>
</html>

